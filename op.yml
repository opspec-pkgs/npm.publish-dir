name: github.com/opspec-pkgs/npm.publish-dir
description: runs npm publish on a directory
inputs:
  email:
    string:
      description: email cred for auth w/ registry
  username:
    string:
      description: username cred for auth w/ registry
  password:
    string:
      description: password cred for auth w/ registry
      isSecret: true
  access:
    string:
      constraints: { enum: [public, restricted]}
      description: |
                    Tells the registry whether this package should be published as public or restricted. Only applies to
                    scoped packages. If you don't have a paid account, you must publish with --access public to publish
                    scoped packages
      default: restricted
  pkgDir:
    dir:
      description: npm package directory
      default: .
  registry:
    string:
      constraints: { minLength: 1, format: uri }
      description: registry for npm to use during install
      default: https://registry.npmjs.org/
  tag:
    string:
      description: |
                    Registers the published package with the given tag, such that npm install <name>@<tag> will install
                    this version. By default, npm publish updates and npm install installs the latest tag
      default: latest
version: 1.0.0
run:
  container:
    cmd: [ /cmd.sh ]
    dirs:
      /pkgDir: $(pkgDir)
    envVars:
      CI: "true"
      NPM_CONFIG_REGISTRY: $(registry)
      email: $(email)
      username: $(username)
      password: $(password)
      access: $(access)
    files:
      /cmd.sh:
    image: { ref: 'node:8.6.0-alpine' }
    workDir: /pkgDir
